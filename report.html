<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Report ‚Äî Listing Lens</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;0,9..40,900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #f0f1f3;
  --surface: #f8f9fa;
  --surface-raised: #eceef1;
  --border: #e2e8f0;
  --border-strong: #cbd5e1;
  --ink: #0f172a;
  --text: #1e293b;
  --text-secondary: #475569;
  --text-dim: #64748b;
  --cyan: #0284c7;
  --cyan-bg: #f0f9ff;
  --red: #dc2626;
  --red-bg: #fef2f2;
  --red-border: #fecaca;
  --red-glow: rgba(220,38,38,0.4);
  --orange: #ea580c;
  --orange-bg: #fff7ed;
  --orange-border: #fed7aa;
  --green: #16a34a;
  --green-bg: #f0fdf4;
  --green-border: #bbf7d0;
  --font: 'DM Sans', system-ui, -apple-system, sans-serif;
  --mono: 'Space Mono', monospace;
}

html { font-family: var(--font); -webkit-font-smoothing: antialiased; background: var(--bg); color: var(--text); }
body { margin: 0; min-height: 100vh; }
.container { max-width: 800px; margin: 0 auto; padding: 32px 20px 140px; }
@media (min-width: 768px) { .container { padding: 40px 24px 140px; } }

/* ============================================================
   LOADING
   ============================================================ */
.report-loading { text-align: center; padding: 8rem 1rem; }
.ld-spinner {
  width: 44px; height: 44px; border: 3px solid var(--border);
  border-top-color: var(--cyan); border-radius: 50%;
  animation: spin 0.8s linear infinite; margin: 0 auto 1.5rem;
}
@keyframes spin { to { transform: rotate(360deg); } }
.report-loading h2 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--ink); }
.ld-step { font-size: 0.82rem; color: var(--text-dim); margin-bottom: 0.25rem; transition: all 0.3s; }
.ld-step.active { color: var(--cyan); font-weight: 600; }
.ld-step.done { color: var(--text-dim); opacity: 0.4; }
.ld-step.done::before { content: '‚úì '; color: var(--green); }

/* ============================================================
   ERROR
   ============================================================ */
.report-error { text-align: center; padding: 8rem 1rem; display: none; }
.report-error h2 { font-size: 1rem; color: var(--red); margin: 1rem 0 0.5rem; }
.report-error p { font-size: 0.85rem; color: var(--text-secondary); max-width: 400px; margin: 0 auto 1.5rem; line-height: 1.6; }
.err-btn { display: inline-block; padding: 10px 24px; background: var(--ink); color: #fff; font-family: var(--font); font-size: 0.82rem; font-weight: 600; border-radius: 8px; text-decoration: none; }

/* ============================================================
   REPORT
   ============================================================ */
.report { display: none; }

/* TOPBAR */
.topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; border-bottom: 2px solid var(--ink); padding-bottom: 12px; }
.topbar-logo { font-family: var(--mono); font-weight: 700; letter-spacing: 2px; color: var(--ink); font-size: 14px; text-decoration: none; }
.topbar-ts { font-family: var(--mono); font-size: 10px; color: var(--text-dim); text-align: right; }

/* HEADER */
.rpt-header { margin-bottom: 28px; }
.rpt-header h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.02em; color: var(--ink); margin-bottom: 8px; line-height: 1.25; }
@media (max-width: 600px) { .rpt-header h1 { font-size: 22px; } }
.meta-tags { display: flex; flex-wrap: wrap; gap: 8px; }
.meta-tag { font-family: var(--mono); font-size: 11px; color: var(--text-dim); background: var(--surface); padding: 4px 10px; border-radius: 4px; border: 1px solid var(--border-strong); }

/* VERDICT HERO */
.verdict-hero {
  background: var(--surface); border: 1px solid var(--border-strong); border-radius: 12px;
  padding: 36px 32px; text-align: center; margin-bottom: 28px;
  position: relative; overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
}
.verdict-hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; border-radius: 12px 12px 0 0; }
.vh-red::before { background: var(--red); }
.vh-amber::before { background: var(--orange); }
.vh-green::before { background: var(--green); }
.v-badge {
  display: inline-block; font-family: var(--mono); font-weight: 700;
  padding: 4px 12px; border-radius: 4px; margin-bottom: 14px; font-size: 11px;
  text-transform: uppercase; letter-spacing: 1px;
}
.vb-red { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-border); }
.vb-amber { background: var(--orange-bg); color: var(--orange); border: 1px solid var(--orange-border); }
.vb-green { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }
.verdict-hero h2 { font-size: 24px; margin-bottom: 10px; color: var(--ink); }
.verdict-hero p { color: var(--text-secondary); max-width: 600px; margin: 0 auto; font-size: 14px; line-height: 1.6; }

/* VISUAL GRID */
.vis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 8px; }
@media (max-width: 600px) { .vis-grid { grid-template-columns: 1fr; } }
.vis-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
.vis-card h4 { font-family: var(--mono); font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-dim); margin-bottom: 14px; }
/* gauge */
.gauge-track { height: 6px; background: var(--surface-raised); border-radius: 3px; position: relative; margin: 18px 0 8px; }
.gauge-range { height: 100%; border-radius: 3px; position: absolute; background: var(--cyan); opacity: 0.25; }
.gauge-marker { position: absolute; top: -8px; width: 2px; height: 22px; background: var(--ink); }
.gauge-labels { display: flex; justify-content: space-between; font-family: var(--mono); font-size: 9px; color: var(--text-dim); }
/* sentiment bar */
.sent-minibar { display: flex; gap: 2px; margin-top: 14px; }
.sent-minibar-pos { height: 6px; background: var(--green); border-radius: 3px 0 0 3px; }
.sent-minibar-neg { height: 6px; background: var(--red); border-radius: 0 3px 3px 0; }
.sent-minilabels { display: flex; justify-content: space-between; font-family: var(--mono); font-size: 9px; color: var(--text-dim); margin-top: 6px; }
/* safety card */
.safety-value { font-family: var(--mono); font-size: 20px; font-weight: 700; margin-top: 4px; }
.safety-sub { font-size: 11px; color: var(--text-dim); margin-top: 2px; }

/* SECTION TITLES */
.sec-title {
  font-family: var(--mono); font-size: 11px; color: var(--text-dim); letter-spacing: 1.5px;
  text-transform: uppercase; margin: 36px 0 14px; display: flex; align-items: center; gap: 10px;
}
.sec-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* FLAG CARDS */
.flag-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 8px;
  padding: 16px 18px; margin-bottom: 10px; display: flex; gap: 14px;
}
.flag-dot { width: 10px; height: 10px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
.fc-red .flag-dot { background: var(--red); box-shadow: 0 0 8px var(--red-glow); }
.fc-amber .flag-dot { background: var(--orange); }
.fc-green .flag-dot { background: var(--green); }
.flag-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 3px; color: var(--ink); }
.flag-card p { font-size: 13px; color: var(--text-secondary); line-height: 1.55; }

/* SENTIMENT DETAIL */
.sent-summary { font-size: 13px; color: var(--text-secondary); font-style: italic; line-height: 1.6; margin-bottom: 14px; }
.sent-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (max-width: 600px) { .sent-grid { grid-template-columns: 1fr; } }
.sent-box { background: var(--surface-raised); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; }
.sent-box h5 { font-family: var(--mono); font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; }
.sent-box.pros h5 { color: var(--green); }
.sent-box.cons h5 { color: var(--red); }
.sent-box ul { list-style: none; }
.sent-box li { font-size: 12.5px; color: var(--text-secondary); line-height: 1.5; padding: 5px 0; border-bottom: 1px solid var(--border); }
.sent-box li:last-child { border-bottom: none; }
.sent-box.pros li::before { content: '‚úì '; color: var(--green); font-weight: 700; }
.sent-box.cons li::before { content: '‚úó '; color: var(--red); font-weight: 700; }

/* COST TABLE */
.cost-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 4px 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
.cost-tbl { width: 100%; border-collapse: collapse; }
.cost-tbl tr { border-bottom: 1px solid var(--border); }
.cost-tbl tr:last-child { border-bottom: none; }
.cost-tbl td { padding: 10px 0; font-size: 13px; color: var(--text-secondary); }
.cost-tbl td:last-child { text-align: right; font-family: var(--mono); font-size: 12px; font-weight: 700; color: var(--ink); white-space: nowrap; }
.cost-total td { color: var(--cyan) !important; font-weight: 700 !important; padding-top: 14px; }
.ct { display: inline-block; font-family: var(--mono); font-size: 9px; padding: 2px 5px; border-radius: 3px; margin-left: 6px; font-weight: 600; letter-spacing: 0.3px; text-transform: uppercase; vertical-align: middle; }
.ct-once { background: var(--cyan-bg); color: var(--cyan); }
.ct-yr { background: var(--green-bg); color: var(--green); }

/* QUESTION GRID */
.q-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
@media (max-width: 600px) { .q-grid { grid-template-columns: 1fr; } }
.q-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; }
.q-cat { display: block; font-family: var(--mono); font-size: 10px; font-weight: 700; color: var(--cyan); letter-spacing: 0.5px; margin-bottom: 3px; }
.q-txt { font-size: 12.5px; color: var(--text-secondary); line-height: 1.45; }
.q-flat { font-size: 13px; color: var(--text-secondary); padding: 8px 0; border-bottom: 1px solid var(--border); }
.q-flat:last-child { border-bottom: none; }

/* CHECKLIST */
.cl-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
.cl-item {
  display: flex; gap: 12px; align-items: center; padding: 12px 18px;
  border-bottom: 1px solid var(--border); font-size: 13px; color: var(--text-secondary);
}
.cl-item:last-child { border-bottom: none; }
.cb {
  flex-shrink: 0; width: 18px; height: 18px; border: 2px solid var(--border-strong);
  border-radius: 4px; cursor: pointer; display: flex; align-items: center;
  justify-content: center; transition: all 0.15s; position: relative;
}
.cb.checked { background: var(--ink); border-color: var(--ink); }
.cb.checked::after { content: '‚úì'; color: #fff; font-size: 11px; font-weight: 700; }
.cl-item.done { opacity: 0.35; }
.cl-item.done span { text-decoration: line-through; }

/* PROSE */
.prose { font-size: 13px; color: var(--text-secondary); line-height: 1.65; }

/* SOURCES */
.src-list { list-style: none; }
.src-list li { font-size: 12px; padding: 5px 0; border-bottom: 1px solid var(--border); color: var(--text-dim); }
.src-list li:last-child { border-bottom: none; }
.src-list a { color: var(--cyan); text-decoration: none; }
.src-list a:hover { text-decoration: underline; }

/* REPORT STAMP */
.rpt-stamp { text-align: center; margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--border); font-family: var(--mono); font-size: 10px; color: var(--text-dim); letter-spacing: 1.5px; }

/* ============================================================
   STICKY ACTION BAR ‚Äî dark slate
   ============================================================ */
.action-bar {
  position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
  width: calc(100% - 32px); max-width: 800px;
  background: var(--ink); color: #fff;
  padding: 14px 20px; border-radius: 12px;
  display: none; justify-content: space-between; align-items: center;
  z-index: 100; box-shadow: 0 8px 32px rgba(0,0,0,0.25);
}
.ab-left { display: flex; flex-direction: column; gap: 2px; }
.ab-text { font-family: var(--mono); font-size: 11px; color: rgba(255,255,255,0.7); }
.ab-id { font-family: var(--mono); font-size: 9px; color: rgba(255,255,255,0.35); letter-spacing: 0.5px; }
.ab-btns { display: flex; gap: 8px; }
.ab-btn {
  padding: 8px 16px; border-radius: 6px; font-family: var(--font); font-size: 13px;
  font-weight: 700; cursor: pointer; border: none; text-decoration: none; transition: all 0.15s;
}
.ab-btn--print { background: var(--cyan); color: #fff; }
.ab-btn--print:hover { opacity: 0.85; }
.ab-btn--email { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.15); }
.ab-btn--email:hover { background: rgba(255,255,255,0.12); color: #fff; }

/* EMAIL OVERLAY */
.email-overlay {
  display: none; position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
  width: calc(100% - 40px); max-width: 380px; background: var(--surface);
  border: 1px solid var(--border-strong); border-radius: 12px; padding: 20px; z-index: 101;
  box-shadow: 0 8px 32px rgba(0,0,0,0.15);
}
.eo-input { width: 100%; padding: 10px 14px; background: var(--bg); border: 1px solid var(--border-strong); border-radius: 8px; font-family: var(--font); font-size: 13px; color: var(--text); outline: none; margin-bottom: 8px; }
.eo-input:focus { border-color: var(--cyan); }
.eo-input::placeholder { color: var(--text-dim); }
.eo-send { width: 100%; padding: 10px; background: var(--ink); color: #fff; border: none; border-radius: 8px; font-family: var(--font); font-size: 13px; font-weight: 700; cursor: pointer; }
.eo-note { font-size: 11px; color: var(--text-dim); margin-top: 6px; text-align: center; }
.eo-note a { color: var(--cyan); text-decoration: none; }

/* DATA WARNING */
.data-warn { display: none; background: var(--orange-bg); border: 1px solid var(--orange-border); border-radius: 8px; padding: 12px 16px; margin-top: 12px; }
.data-warn p { font-size: 12px; color: var(--orange); text-align: center; line-height: 1.5; }

.another { display: none; margin-top: 12px; text-align: center; }
.another a { display: inline-block; padding: 10px 24px; font-size: 13px; font-weight: 600; color: var(--text-secondary); border: 1px solid var(--border-strong); border-radius: 8px; text-decoration: none; }
.another a:hover { border-color: var(--ink); color: var(--ink); }
.pg-foot { text-align: center; padding: 20px 0 32px; margin-top: 12px; border-top: 1px solid var(--border); }
.pg-foot a { font-size: 11px; color: var(--text-dim); text-decoration: none; margin: 0 8px; }
.pg-foot a:hover { color: var(--cyan); }

/* ============================================================
   PRINT
   ============================================================ */
@media print {
  body { background: #fff; }
  .report-loading, .report-error, .action-bar, .email-overlay, .data-warn, .another, .pg-foot { display: none !important; }
  .report { display: block !important; }
  .container { padding: 16px; max-width: 100%; }
  .verdict-hero::before, .flag-dot, .cb.checked, .sent-minibar-pos, .sent-minibar-neg, .gauge-range {
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  .vis-card, .cost-wrap, .cl-wrap, .q-card, .sent-box, .verdict-hero, .flag-card {
    box-shadow: none; break-inside: avoid;
  }
  .action-bar { display: none !important; }
}
</style>
</head>
<body>
<div class="container">

  <div class="report-loading" id="ld">
    <div class="ld-spinner"></div>
    <h2>generating your report</h2>
    <div class="ld-step active" id="s1">reading your screenshots...</div>
    <div class="ld-step" id="s2">searching databases &amp; public records...</div>
    <div class="ld-step" id="s3">analysing red flags &amp; pricing...</div>
    <div class="ld-step" id="s4">writing your report...</div>
  </div>

  <div class="report-error" id="err">
    <div style="font-size:2.5rem">‚ö†Ô∏è</div>
    <h2>something went wrong</h2>
    <p id="errMsg">We couldn't generate your report. Your payment is safe ‚Äî please try again or contact us.</p>
    <a href="/cdn-cgi/l/email-protection#650d00091525090c16110c0b0209000b164b041515" class="err-btn">contact us</a>
  </div>

  <div class="report" id="rpt"></div>

  <div class="data-warn" id="dw"><p><strong>‚ö†Ô∏è</strong> Once you leave this page, your report and screenshots are permanently deleted. Save before closing.</p></div>
  <div class="another" id="ar"><a href="/">‚Üê Analyse another listing</a></div>
  <div class="pg-foot"><a href="/privacy">privacy</a><a href="/terms">terms</a><a href="/cdn-cgi/l/email-protection#fe969b928ebe92978d8a979099929b908dd09f8e8e">contact</a></div>
</div>

<!-- STICKY ACTION BAR -->
<div class="action-bar" id="ab">
  <div class="ab-left">
    <div class="ab-text">Save report before it's deleted</div>
    <div class="ab-id" id="abId"></div>
  </div>
  <div class="ab-btns">
    <button class="ab-btn ab-btn--email" id="abEmail">üìß Email</button>
    <button class="ab-btn ab-btn--print" id="abPrint">Download PDF</button>
  </div>
</div>

<!-- EMAIL OVERLAY -->
<div class="email-overlay" id="eo">
  <input type="email" class="eo-input" id="eoIn" placeholder="your email address">
  <button class="eo-send" id="eoSend">send report</button>
  <p class="eo-note">we'll send the report and delete your email. <a href="/privacy">privacy promise</a></p>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* ============================================================
   LISTING LENS ‚Äî REPORT V3.1 (White / Professional)
   ============================================================ */
function cleanUrl(u){if(!u)return'';var m=u.match(/\[([^\]]+)\]\(([^)]+)\)/);if(m)return m[2];return u.replace(/^\[|\]$/g,'').trim();}
function esc(s){var d=document.createElement('div');d.textContent=s||'';return d.innerHTML;}
function fmtDate(){var d=new Date(),m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return d.getDate()+' '+m[d.getMonth()]+' '+d.getFullYear();}
function lensId(){var c='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',r='LL-';for(var i=0;i<4;i++)r+=c[Math.floor(Math.random()*36)];return r+'-'+Date.now().toString(36).toUpperCase().slice(-4);}

function animLoad(cb){
  var s=['s1','s2','s3','s4'],i=0;
  (function n(){if(i>0){document.getElementById(s[i-1]).classList.remove('active');document.getElementById(s[i-1]).classList.add('done');}
  if(i<s.length){document.getElementById(s[i]).classList.add('active');i++;setTimeout(n,800+Math.random()*400);}
  else setTimeout(cb,300);})();
}

function stripEmoji(s){return(s||'').replace(/^[\u{1F300}-\u{1FAD6}\u{2600}-\u{27BF}\u{FE00}-\u{FEFF}‚úÖ‚ö†Ô∏èüö®‚ùì‚öñÔ∏èüîóüí∞üë•]+\s*/u,'');}
function badgeLabel(l){return l==='red'?'High Risk':l==='amber'?'Caution Advised':'Low Risk';}
function costTag(l,v){var t=(l+' '+v).toLowerCase();if(/stamp|ppsr|inspection|one-off|transfer/i.test(t))return'<span class="ct ct-once">One-off</span>';if(/annual|\/year|renewal|insurance|fuel|servic|ctp|green slip|comprehen/i.test(t))return'<span class="ct ct-yr">Annual</span>';return'';}

function renderReport(data){
  document.getElementById('ld').style.display='none';
  document.getElementById('rpt').style.display='block';
  document.getElementById('ab').style.display='flex';
  document.getElementById('dw').style.display='block';
  document.getElementById('ar').style.display='block';
  document.getElementById('abId').textContent=lensId();

  var v=data.verdict, h='';

  // TOPBAR
  h+='<nav class="topbar"><a href="/" class="topbar-logo">LISTING LENS</a><div class="topbar-ts">GENERATED '+fmtDate().toUpperCase()+'</div></nav>';

  // HEADER
  h+='<header class="rpt-header"><h1>'+esc(data.title)+'</h1><div class="meta-tags">';
  if(data.price)h+='<span class="meta-tag">'+esc(data.price)+'</span>';
  if(data.location)h+='<span class="meta-tag">'+esc(data.location)+'</span>';
  if(data.category)h+='<span class="meta-tag">'+esc(data.category)+'</span>';
  h+='</div></header>';

  // VERDICT HERO
  h+='<section class="verdict-hero vh-'+v.level+'">';
  h+='<div class="v-badge vb-'+v.level+'">'+badgeLabel(v.level)+'</div>';
  h+='<h2>'+esc(v.heading)+'</h2>';
  h+='<p>'+esc(v.summary)+'</p></section>';

  // VISUAL GRID
  var hasSent=false,prosN=0,consN=0,hasRedFlags=false;
  data.sections.forEach(function(s){
    if(s.ownerSentiment){hasSent=true;prosN=(s.ownerSentiment.pros||[]).length;consN=(s.ownerSentiment.cons||[]).length;}
    if(s.flags)s.flags.forEach(function(f){if(f.level==='red')hasRedFlags=true;});
  });
  var total=prosN+consN||1, posPct=Math.round(prosN/total*100);

  h+='<div class="vis-grid">';
  // Price gauge
  h+='<div class="vis-card"><h4>Market Value Position</h4>';
  h+='<div class="gauge-track"><div class="gauge-range" style="left:20%;width:60%;"></div>';
  h+='<div class="gauge-marker" style="left:55%"></div></div>';
  h+='<div class="gauge-labels"><span>Below market</span><span>Above market</span></div></div>';
  // Second card: sentiment or safety
  if(hasSent){
    h+='<div class="vis-card"><h4>Owner Sentiment</h4>';
    h+='<div class="sent-minibar"><div class="sent-minibar-pos" style="flex:'+posPct+'"></div><div class="sent-minibar-neg" style="flex:'+(100-posPct)+'"></div></div>';
    h+='<div class="sent-minilabels"><span>'+posPct+'% POSITIVE</span><span>'+(100-posPct)+'% CONCERNS</span></div></div>';
  } else {
    h+='<div class="vis-card"><h4>Safety Status</h4>';
    if(hasRedFlags){h+='<div class="safety-value" style="color:var(--red)">POOR</div><div class="safety-sub">Critical findings detected</div>';}
    else{h+='<div class="safety-value" style="color:var(--green)">CLEAR</div><div class="safety-sub">No critical issues found</div>';}
    h+='</div>';
  }
  h+='</div>';

  // SECTIONS
  data.sections.forEach(function(s){
    var title=stripEmoji(s.heading);
    h+='<div class="sec-title">'+esc(title).toUpperCase()+'</div>';

    // FLAGS
    if(s.flags)s.flags.forEach(function(f){
      h+='<div class="flag-card fc-'+f.level+'"><div class="flag-dot"></div><div><h3>'+esc(f.title)+'</h3><p>'+esc(f.detail)+'</p></div></div>';
    });

    // OWNER SENTIMENT DETAIL
    if(s.ownerSentiment){
      var o=s.ownerSentiment;
      if(o.summary)h+='<div class="sent-summary">'+esc(o.summary)+'</div>';
      h+='<div class="sent-grid">';
      if(o.pros&&o.pros.length){h+='<div class="sent-box pros"><h5>What owners love</h5><ul>';o.pros.forEach(function(p){h+='<li>'+esc(p)+'</li>';});h+='</ul></div>';}
      if(o.cons&&o.cons.length){h+='<div class="sent-box cons"><h5>Common complaints</h5><ul>';o.cons.forEach(function(c){h+='<li>'+esc(c)+'</li>';});h+='</ul></div>';}
      h+='</div>';
    }

    // COSTS
    if(s.costs){
      h+='<div class="cost-wrap"><table class="cost-tbl">';
      s.costs.forEach(function(c){var cls=c.isTotal?' class="cost-total"':'';var tag=c.isTotal?'':costTag(c.label,c.value);h+='<tr'+cls+'><td>'+esc(c.label)+tag+'</td><td>'+esc(c.value)+'</td></tr>';});
      h+='</table></div>';
    }

    // QUESTIONS
    if(s.questions&&s.questions.length){
      if(typeof s.questions[0]==='object'){
        h+='<div class="q-grid">';s.questions.forEach(function(q){h+='<div class="q-card"><span class="q-cat">'+esc(q.category)+'</span><span class="q-txt">'+esc(q.text)+'</span></div>';});h+='</div>';
      }else{s.questions.forEach(function(q,i){h+='<div class="q-flat">'+(i+1)+'. '+esc(q)+'</div>';});}
    }

    // CHECKLIST
    if(s.checklist){
      h+='<div class="cl-wrap">';
      s.checklist.forEach(function(item){h+='<div class="cl-item"><div class="cb"></div><span>'+esc(item)+'</span></div>';});
      h+='</div>';
    }

    // TEXT
    if(s.text)h+='<div class="prose">'+esc(s.text)+'</div>';

    // SOURCES
    if(s.sources){h+='<ul class="src-list">';s.sources.forEach(function(src){var u=cleanUrl(src.url);h+='<li>'+(u?'<a href="'+esc(u)+'" target="_blank" rel="noopener">'+esc(src.label)+'</a>':esc(src.label))+'</li>';});h+='</ul>';}
  });

  h+='<div class="rpt-stamp">LISTING LENS ¬∑ '+fmtDate().toUpperCase()+' ¬∑ FOR INFORMATIONAL PURPOSES ONLY</div>';
  document.getElementById('rpt').innerHTML=h;

  // Checklist interactivity
  document.querySelectorAll('.cb').forEach(function(b){
    b.addEventListener('click',function(){this.classList.toggle('checked');this.parentElement.classList.toggle('done');});
  });
}

function showError(m){document.getElementById('ld').style.display='none';document.getElementById('err').style.display='block';if(m)document.getElementById('errMsg').textContent=m;}

// ACTION BAR
document.getElementById('abPrint').addEventListener('click',function(){window.print();});
document.getElementById('abEmail').addEventListener('click',function(){var o=document.getElementById('eo');o.style.display=o.style.display==='block'?'none':'block';if(o.style.display==='block')document.getElementById('eoIn').focus();});
document.getElementById('eoSend').addEventListener('click',function(){var e=document.getElementById('eoIn').value.trim();if(!e||!e.includes('@')){document.getElementById('eoIn').style.borderColor='var(--red)';return;}var b=this;b.textContent='sending...';b.disabled=true;setTimeout(function(){b.textContent='‚úì sent!';b.style.background='var(--green)';b.style.color='#fff';setTimeout(function(){document.getElementById('eo').style.display='none';},800);},1500);});
// Close email overlay when clicking outside
document.addEventListener('click',function(e){var eo=document.getElementById('eo');if(eo.style.display==='block'&&!eo.contains(e.target)&&e.target.id!=='abEmail')eo.style.display='none';});

/* ============================================================
   DEMO DATA ‚Äî V3.1
   ============================================================ */
var demoData={vehicle:{
  category:'Vehicle Analysis',title:'2015 Jeep Wrangler Unlimited Sport Auto 4x4 MY15',price:'$22,500',location:'NSW ¬∑ Private Sale',country:'Australia',
  verdict:{level:'red',icon:'üö®',heading:'Proceed with Caution',summary:'The price is roughly in line with market for the mileage, but there are several significant concerns. The registration is expiring February 2026, the 3.6L Pentastar at 156,000 km is entering the zone where costly rocker arm and lifter failures become likely, the vehicle falls within the Takata airbag recall range, and visible aftermarket modifications raise insurance and compliance questions. Thorough due diligence is essential.'},
  sections:[
    {heading:'üö® Critical findings',flags:[
      {level:'red',title:'Registration Expiring This Month',detail:'The registration expires February 2026 ‚Äî that is right now. It may already be expired. An unregistered vehicle cannot legally be driven. Confirm the exact expiry date and whether it will still be registered when you collect it.'},
      {level:'red',title:'Takata Airbag Recall ‚Äî Check Required',detail:'The 2014-2016 Jeep Wrangler JK is covered by Takata airbag recall PRA 2018/16702. A degraded inflator can rupture in a crash, projecting metal fragments. Verify at ismyairbagsafe.com.au or ask seller for dealer proof.'},
      {level:'red',title:'3.6L Pentastar at 156,000 km ‚Äî High-Risk Mileage',detail:'Documented pattern of rocker arm and lifter failure from 60,000-160,000 km. This vehicle is squarely in that zone. Listen for ticking on cold start. Repair costs $2,400-$6,500.'}
    ]},
    {heading:'‚ö†Ô∏è Additional concerns',flags:[
      {level:'amber',title:'Registration Plate Withheld ‚Äî Cannot Run PPSR',detail:'Listed as "Check with seller." Without plate or VIN you cannot run PPSR for finance, write-off, or stolen flags. Request before committing your time.'},
      {level:'amber',title:'Visible Aftermarket Modifications',detail:'Photos show aftermarket alloy wheels and what appears to be a bull bar. Undisclosed mods may void insurance claims and affect roadworthiness. Ask for a full list.'},
      {level:'amber',title:'Additional Recalls ‚Äî Clockspring & Emissions',detail:'2015 JK Wranglers have recalls for clockspring assembly fault and emissions PCM reprogramming. Confirm all completed via VIN at vehiclerecalls.gov.au.'},
      {level:'amber',title:'TIPM, Oil Cooler & Other Known Issues',detail:'Known for: oil cooler housing leaks, TIPM failures ($900-$1,200), brake booster failures, parking brake issues. Jeep-specialist inspection strongly recommended.'}
    ]},
    {heading:'‚úÖ Positive findings',flags:[
      {level:'green',title:'Price Broadly In-Market',detail:'$22,500 sits within the typical private-sale range. CarsGuide values 2015 Wranglers from $12,100 to $31,900 depending on variant and condition.'},
      {level:'green',title:'Seller ID Verified',detail:'CarSales "ID verified" badge present. Better than anonymous but not a substitute for PPSR checks.'},
      {level:'green',title:'Soft Top ‚Äî Lower Entry Point',detail:'Soft top variant typically prices at the lower end of the Unlimited range, consistent with the ask.'}
    ]},
    {heading:'üë• What owners say',ownerSentiment:{
      summary:'JK Wrangler Unlimited 3.6L owners love the off-road ability and lifestyle factor, but commonly report trade-offs in comfort, fuel economy, and front-end wear.',
      pros:['Genuinely capable off-road with massive aftermarket support','Removable roof and doors ‚Äî experience no other SUV offers','Pentastar 3.6L more reliable than earlier engines when maintained','4-door Unlimited holds stronger resale than 2-door'],
      cons:['Real-world fuel 13-15 L/100km, worse with lift or bigger tyres','Highway noise and ride noticeably worse than comparable SUVs','Front-end steering/suspension wears frequently at higher km','Interior fit, water sealing, and rattles a consistent complaint']
    }},
    {heading:'üí∞ Hidden costs (NSW estimate)',costs:[
      {label:'NSW Stamp Duty',value:'~$675'},{label:'PPSR Check',value:'$2'},
      {label:'Pre-purchase Inspection (4x4 specialist)',value:'$300 ‚Äì $600'},
      {label:'NSW Registration Renewal',value:'$400 ‚Äì $700'},
      {label:'CTP / Green Slip',value:'$500 ‚Äì $900'},
      {label:'Comprehensive Insurance',value:'$1,200 ‚Äì $2,500'},
      {label:'Fuel (15,000 km √ó 11.7 L/100km √ó $2.00/L)',value:'~$3,510/year'},
      {label:'Servicing (2 √ó $350-$500)',value:'$700 ‚Äì $1,000/year'},
      {label:'Estimated first-year costs beyond purchase price',value:'$7,000 ‚Äì $10,000',isTotal:true}
    ]},
    {heading:'‚ùì Questions to ask the seller',questions:[
      {category:'Registration & Rego Plate',text:'What is the registration plate number and exact expiry date? Will it still be registered at collection?'},
      {category:'VIN & Recall Status',text:'What is the full VIN? Have all Takata and other recalls been completed? Dealer receipts please.'},
      {category:'Engine History',text:'Any ticking noise? Have rocker arms, lifters, or camshafts been inspected or replaced? Any oil leaks?'},
      {category:'Modifications',text:'Full list of aftermarket parts fitted. Original wheels/bumper included? Workshop receipts?'},
      {category:'Service History',text:'Complete service history? Dealer or independent? When was last oil change?'},
      {category:'Ownership & Finance',text:'How long owned? Previous owners? Finance owing? Insurance claims or accident history?'},
      {category:'PPSR & Write-Off',text:'Ever declared a write-off? Ever registered in another state?'},
      {category:'Reason for Selling',text:'Why selling? Current mechanical or electrical issues?'}
    ]},
    {heading:'‚úÖ Pre-purchase checklist',checklist:[
      'Request VIN and registration plate before attending any inspection',
      'Run PPSR check ($2 at ppsr.gov.au) for finance, write-off, stolen status',
      'Check Takata recall at ismyairbagsafe.com.au',
      'Check all recalls at vehiclerecalls.gov.au using VIN',
      'Book 4x4 specialist inspection ‚Äî request valve train and oil cooler focus',
      'Cold-start the engine and listen for ticking from either bank',
      'Verify registration status and expiry ‚Äî factor in re-registration cost',
      'Inspect soft top for tears, window clarity, zipper condition',
      'Test all electrics ‚Äî lights, wipers, horn, fuel pump prime (TIPM check)',
      'Confirm insurance quote with accurate modification disclosure',
      'Get seller\'s key claims in writing (text/email) before any payment'
    ]},
    {heading:'‚öñÔ∏è Your rights (Australia/NSW)',text:'In a private sale, the Australian Consumer Law (ACL) provides limited protections compared to buying from a business. The goods must match their description and the seller must have the legal right to sell. However, consumer guarantees regarding acceptable quality and fitness for purpose generally do not apply to private sales. Your primary protections come from your own due diligence ‚Äî PPSR checks, independent inspections, and getting the seller\'s key claims in writing before payment.'},
    {heading:'üîó Sources used in this report',sources:[
      {label:'PPSR ‚Äî finance, write-off, stolen check ($2)',url:'https://www.ppsr.gov.au'},
      {label:'Is My Airbag Safe ‚Äî Takata recall check',url:'https://www.ismyairbagsafe.com.au'},
      {label:'ACCC Product Safety ‚Äî Jeep JK Takata recall',url:'https://www.productsafety.gov.au/recalls/fca-australia-pty-ltd-jeep-wrangler-jk-my2014-2016'},
      {label:'Vehicle Recalls Australia ‚Äî all recalls by VIN',url:'https://www.vehiclerecalls.gov.au'},
      {label:'Service NSW ‚Äî stamp duty & rego transfer',url:'https://www.service.nsw.gov.au'},
      {label:'ACCC consumer rights',url:'https://www.accc.gov.au/consumers'},
      {label:'CarsGuide ‚Äî 2015 Wrangler valuation',url:'https://www.carsguide.com.au/jeep/wrangler/price/2015'}
    ]}
  ]
}};

/* ============================================================
   INIT
   ============================================================ */
(function(){
  var p=new URLSearchParams(window.location.search),demo=p.get('demo');
  if(demo&&demoData[demo]){animLoad(function(){renderReport(demoData[demo]);});return;}
  var rj=sessionStorage.getItem('listinglens_report');
  if(rj){try{var d=JSON.parse(rj);animLoad(function(){renderReport(d);});sessionStorage.removeItem('listinglens_report');}catch(
