<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Report ‚Äî Listing Lens</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;0,9..40,900&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --white: #FFFFFF;
  --snow: #F9FAFB;
  --gray-100: #E5E7EB;
  --gray-200: #D1D5DB;
  --slate-900: #0F172A;
  --slate-800: #1E293B;
  --slate-700: #334155;
  --slate-600: #475569;
  --slate-500: #64748B;
  --slate-400: #94A3B8;
  --emerald: #10B981;
  --emerald-light: #6EE7B7;
  --emerald-pale: #D1FAE5;
  --emerald-deep: #059669;
  --emerald-dark: #064E3B;
  --red: #DC2626;
  --red-pale: #FEF2F2;
  --amber: #F59E0B;
  --font: 'DM Sans', system-ui, -apple-system, sans-serif;
}

html { font-family: var(--font); -webkit-font-smoothing: antialiased; background: var(--snow); color: var(--slate-900); }
body { margin: 0; padding: 1rem; min-height: 100vh; }
@media (min-width: 768px) { body { padding: 2rem; } }

/* ============================================================
   LAYOUT
   ============================================================ */
.report-wrapper {
  max-width: 720px;
  margin: 0 auto;
}

/* ============================================================
   TOP BAR
   ============================================================ */
.report-topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.8rem 0;
  margin-bottom: 1rem;
  border-bottom: 1px solid var(--gray-100);
}
.report-logo {
  font-size: 1rem;
  font-weight: 800;
  color: var(--slate-900);
  text-decoration: none;
  letter-spacing: -0.02em;
}
.report-logo em {
  font-style: normal;
}
.report-topbar-meta {
  font-size: 0.7rem;
  color: var(--slate-400);
  text-align: right;
  line-height: 1.5;
}

/* ============================================================
   LOADING STATE
   ============================================================ */
.report-loading {
  text-align: center;
  padding: 4rem 1rem;
}
.report-loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--gray-100);
  border-top-color: var(--emerald);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin: 0 auto 1.5rem;
}
@keyframes spin { to { transform: rotate(360deg); } }
.report-loading h2 {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}
.report-loading-step {
  font-size: 0.85rem;
  color: var(--slate-500);
  margin-bottom: 0.3rem;
  transition: all 0.3s;
}
.report-loading-step.active {
  color: var(--emerald-deep);
  font-weight: 600;
}
.report-loading-step.done {
  color: var(--slate-400);
}
.report-loading-step.done::before {
  content: '‚úì ';
  color: var(--emerald);
}

/* ============================================================
   ERROR STATE
   ============================================================ */
.report-error {
  text-align: center;
  padding: 4rem 1rem;
  display: none;
}
.report-error-icon { font-size: 2.5rem; margin-bottom: 1rem; }
.report-error h2 {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: var(--red);
}
.report-error p {
  font-size: 0.85rem;
  color: var(--slate-500);
  line-height: 1.6;
  max-width: 400px;
  margin: 0 auto 1.5rem;
}
.report-error-btn {
  display: inline-block;
  padding: 0.7rem 1.8rem;
  background: var(--slate-900);
  color: var(--white);
  font-family: var(--font);
  font-size: 0.85rem;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.15s;
}
.report-error-btn:hover { background: var(--emerald-deep); }

/* ============================================================
   REPORT CARD
   ============================================================ */
.report-card {
  border: 2px solid var(--emerald);
  border-radius: 16px;
  overflow: hidden;
  background: var(--white);
  display: none;
}

/* Header bar */
.report-header {
  background: var(--slate-900);
  padding: 1.2rem;
}
.report-header-label {
  font-size: 0.65rem;
  font-weight: 700;
  color: var(--slate-400);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}
.report-header-title {
  font-size: 1.05rem;
  font-weight: 800;
  color: var(--white);
  line-height: 1.3;
  margin-bottom: 0.3rem;
}
.report-header-meta {
  font-size: 0.78rem;
  color: var(--slate-400);
  line-height: 1.4;
}
.report-header-category {
  display: inline-block;
  font-size: 0.6rem;
  font-weight: 700;
  background: rgba(255,255,255,0.1);
  color: var(--slate-400);
  padding: 0.2rem 0.6rem;
  border-radius: 100px;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  margin-top: 0.6rem;
}

/* Verdict */
.report-verdict {
  display: flex;
  gap: 0.8rem;
  padding: 1.2rem;
  align-items: flex-start;
}
.report-verdict--red { background: #FEF2F2; border-bottom: 2px solid #FECACA; }
.report-verdict--amber { background: #FFFBEB; border-bottom: 2px solid #FDE68A; }
.report-verdict--green { background: #F0FDF4; border-bottom: 2px solid #BBF7D0; }
.report-verdict-icon { font-size: 1.5rem; flex-shrink: 0; }
.report-verdict strong {
  display: block;
  font-size: 0.85rem;
  margin-bottom: 0.3rem;
}
.report-verdict--red strong { color: #DC2626; }
.report-verdict--amber strong { color: #92400E; }
.report-verdict--green strong { color: #065F46; }
.report-verdict p {
  font-size: 0.78rem;
  line-height: 1.6;
}
.report-verdict--red p { color: #7F1D1D; }
.report-verdict--amber p { color: #78350F; }
.report-verdict--green p { color: #064E3B; }

/* Sections */
.report-section {
  padding: 1.2rem;
  border-bottom: 1px solid var(--gray-100);
}
.report-section:last-of-type { border-bottom: none; }
.report-section h4 {
  font-size: 0.85rem;
  font-weight: 800;
  margin-bottom: 0.8rem;
}

/* Flags */
.report-flag {
  padding: 0.8rem 1rem;
  border-radius: 10px;
  margin-bottom: 0.6rem;
}
.report-flag--red { background: #FEF2F2; border-left: 4px solid #DC2626; }
.report-flag--amber { background: #FFFBEB; border-left: 4px solid #F59E0B; }
.report-flag--green { background: #F0FDF4; border-left: 3px solid #10B981; }
.report-flag strong {
  display: block;
  font-size: 0.8rem;
  margin-bottom: 0.3rem;
}
.report-flag--red strong { color: #DC2626; }
.report-flag--amber strong { color: #92400E; }
.report-flag--green strong { color: #065F46; }
.report-flag p {
  font-size: 0.75rem;
  line-height: 1.6;
  color: var(--slate-600);
}

/* Costs table */
.report-costs {
  background: var(--snow);
  border-radius: 10px;
  overflow: hidden;
}
.report-cost-row {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  border-bottom: 1px solid var(--gray-100);
}
.report-cost-row:last-child { border-bottom: none; }
.report-cost-row span:first-child { color: var(--slate-600); }
.report-cost-row span:last-child { font-weight: 700; color: var(--slate-900); }
.report-cost-total { background: #FEF2F2; font-weight: 700; }
.report-cost-total span:last-child { color: #DC2626; }

/* Questions */
.report-questions {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
.report-question {
  font-size: 0.78rem;
  color: var(--slate-600);
  line-height: 1.5;
  padding: 0.5rem 0.8rem;
  background: var(--snow);
  border-radius: 8px;
}

/* Rights / general text */
.report-text {
  font-size: 0.78rem;
  color: var(--slate-600);
  line-height: 1.7;
}

/* Sources */
.report-sources {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
.report-sources a {
  font-size: 0.75rem;
  color: var(--emerald-deep);
  text-decoration: none;
  padding: 0.45rem 0.8rem;
  background: var(--snow);
  border-radius: 8px;
  border: 1px solid var(--gray-100);
  transition: all 0.15s;
  display: block;
  word-break: break-word;
}
.report-sources a:hover {
  background: var(--emerald-pale);
  border-color: var(--emerald);
}

/* Footer disclaimer */
.report-footer {
  padding: 0.8rem 1.2rem;
  background: var(--snow);
  border-top: 1px solid var(--gray-100);
  text-align: center;
}
.report-footer p {
  font-size: 0.68rem;
  color: var(--slate-400);
  font-style: italic;
}

/* ============================================================
   DELIVERY CARD ‚Äî below report
   ============================================================ */
.delivery-card {
  margin-top: 1rem;
  background: var(--white);
  border: 1.5px solid var(--gray-100);
  border-radius: 16px;
  padding: 1.5rem;
  display: none;
}
.delivery-card h3 {
  font-size: 0.9rem;
  font-weight: 800;
  margin-bottom: 1rem;
}
.delivery-actions {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}
.delivery-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.2rem;
  border-radius: 10px;
  font-family: var(--font);
  font-size: 0.85rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  border: none;
  text-decoration: none;
}
.delivery-btn--pdf {
  background: var(--slate-900);
  color: var(--white);
}
.delivery-btn--pdf:hover { background: var(--emerald-deep); }
.delivery-btn--email {
  background: var(--white);
  color: var(--slate-700);
  border: 1.5px solid var(--gray-200);
}
.delivery-btn--email:hover {
  border-color: var(--emerald);
  color: var(--emerald-deep);
}
.delivery-email-form {
  display: none;
  margin-top: 0.8rem;
}
.delivery-email-input {
  width: 100%;
  padding: 0.7rem 1rem;
  border: 1.5px solid var(--gray-200);
  border-radius: 10px;
  font-family: var(--font);
  font-size: 0.85rem;
  outline: none;
  transition: border-color 0.15s;
  margin-bottom: 0.5rem;
}
.delivery-email-input:focus { border-color: var(--emerald); }
.delivery-email-send {
  width: 100%;
  padding: 0.65rem;
  background: var(--emerald);
  color: var(--white);
  border: none;
  border-radius: 10px;
  font-family: var(--font);
  font-size: 0.82rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
}
.delivery-email-send:hover { background: var(--emerald-deep); }
.delivery-email-note {
  font-size: 0.7rem;
  color: var(--slate-400);
  margin-top: 0.4rem;
  text-align: center;
}

/* ============================================================
   DATA WARNING
   ============================================================ */
.data-warning {
  margin-top: 1rem;
  padding: 1rem 1.2rem;
  background: #FFFBEB;
  border: 1.5px solid #FDE68A;
  border-radius: 12px;
  display: none;
}
.data-warning p {
  font-size: 0.78rem;
  color: #92400E;
  line-height: 1.5;
  text-align: center;
}
.data-warning strong { font-weight: 700; }

/* ============================================================
   ANOTHER REPORT CTA
   ============================================================ */
.another-report {
  margin-top: 1.5rem;
  text-align: center;
  padding-bottom: 2rem;
  display: none;
}
.another-report a {
  display: inline-block;
  padding: 0.75rem 2rem;
  background: var(--white);
  color: var(--slate-700);
  font-family: var(--font);
  font-size: 0.85rem;
  font-weight: 700;
  border: 1.5px solid var(--gray-200);
  border-radius: 10px;
  text-decoration: none;
  transition: all 0.15s;
}
.another-report a:hover {
  border-color: var(--emerald);
  color: var(--emerald-deep);
}

/* ============================================================
   FOOTER
   ============================================================ */
.report-page-footer {
  text-align: center;
  padding: 1.5rem 0 2rem;
  margin-top: 1rem;
  border-top: 1px solid var(--gray-100);
}
.report-page-footer a {
  font-size: 0.72rem;
  color: var(--slate-400);
  text-decoration: none;
  margin: 0 0.5rem;
}
.report-page-footer a:hover { color: var(--emerald-deep); }
</style>
</head>
<body>

<div class="report-wrapper">

  <!-- TOP BAR -->
  <div class="report-topbar">
    <a href="/" class="report-logo">LISTING LENS</a>
    <div class="report-topbar-meta">
      <div id="reportDate"></div>
      <div id="reportCategory"></div>
    </div>
  </div>

  <!-- LOADING STATE ‚Äî visible by default -->
  <div class="report-loading" id="reportLoading">
    <div class="report-loading-spinner"></div>
    <h2>generating your report</h2>
    <div class="report-loading-step active" id="step1">reading your screenshots...</div>
    <div class="report-loading-step" id="step2">searching databases &amp; public records...</div>
    <div class="report-loading-step" id="step3">analysing red flags &amp; pricing...</div>
    <div class="report-loading-step" id="step4">writing your report...</div>
  </div>

  <!-- ERROR STATE ‚Äî hidden by default -->
  <div class="report-error" id="reportError">
    <div class="report-error-icon">‚ö†Ô∏è</div>
    <h2>something went wrong</h2>
    <p id="reportErrorMsg">We couldn't generate your report. Your payment is safe ‚Äî please try again or contact us.</p>
    <a href="/cdn-cgi/l/email-protection#472f222b2b28616471737c2b2e34332e29202b22293469263737" class="report-error-btn">contact us</a>
  </div>

  <!-- REPORT CARD ‚Äî hidden until generated -->
  <div class="report-card" id="reportCard">
    <!-- Header -->
    <div class="report-header">
      <div class="report-header-label">LISTING LENS REPORT</div>
      <div class="report-header-title" id="reportTitle"></div>
      <div class="report-header-meta" id="reportMeta"></div>
      <span class="report-header-category" id="reportCatBadge"></span>
    </div>
    <!-- Verdict ‚Äî injected by JS -->
    <div id="reportVerdict"></div>
    <!-- Sections ‚Äî injected by JS -->
    <div id="reportSections"></div>
    <!-- Footer -->
    <div class="report-footer">
      <p>This report was generated by Listing Lens using AI analysis. It is not legal, financial, or professional advice. Always conduct your own due diligence before making any purchase.</p>
    </div>
  </div>

  <!-- DELIVERY OPTIONS ‚Äî shown with report -->
  <div class="delivery-card" id="deliveryCard">
    <h3>üì• save your report</h3>
    <div class="delivery-actions">
      <button class="delivery-btn delivery-btn--pdf" id="downloadPdf">
        <span>üìÑ</span> download PDF
      </button>
      <button class="delivery-btn delivery-btn--email" id="emailBtn">
        <span>üìß</span> email me a copy
      </button>
    </div>
    <div class="delivery-email-form" id="emailForm">
      <input type="email" class="delivery-email-input" id="emailInput" placeholder="your email address">
      <button class="delivery-email-send" id="emailSend">send report</button>
      <p class="delivery-email-note">we'll send the report and then delete your email. <a href="/privacy" style="color:var(--emerald-deep);">privacy promise</a></p>
    </div>
  </div>

  <!-- DATA WARNING ‚Äî shown with report -->
  <div class="data-warning" id="dataWarning">
    <p><strong>‚ö†Ô∏è once you leave this page, your report and screenshots are permanently deleted.</strong> download or email your report before closing this tab.</p>
  </div>

  <!-- ANOTHER REPORT CTA -->
  <div class="another-report" id="anotherReport">
    <a href="/">‚Üê analyse another listing</a>
  </div>

  <!-- PAGE FOOTER -->
  <div class="report-page-footer">
    <a href="/privacy">privacy</a>
    <a href="/terms">terms</a>
    <a href="/cdn-cgi/l/email-protection#5c34393030337a7f6a686730352f2835323b3039322f723d2c2c">contact</a>
  </div>

</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* ============================================================
   REPORT PAGE ‚Äî JavaScript
   
   This page receives report data in one of two ways:
   
   1. PRODUCTION: The dashboard page calls the generate-report
      Netlify Function, receives JSON, stores it in sessionStorage,
      and redirects here. This page reads from sessionStorage.
   
   2. DEMO MODE: Add ?demo=vehicle or ?demo=property to the URL
      to show a sample report for testing/development.
   
   The generate-report function will return JSON like:
   {
     category: "vehicle",
     title: "2015 Jeep Wrangler Unlimited Sport 4x4",
     country: "Australia",
     verdict: {
       level: "red" | "amber" | "green",
       icon: "üö®",
       heading: "VERDICT: CAUTION ‚Äî SIGNIFICANT RISKS",
       summary: "This listing has multiple red flags..."
     },
     sections: [
       {
         heading: "üö® Critical findings",
         flags: [
           {
             level: "red" | "amber" | "green",
             title: "Takata airbag recall...",
             detail: "The 2015 Jeep Wrangler..."
           }
         ]
       },
       {
         heading: "üí∞ Hidden costs",
         costs: [
           { label: "Stamp duty", value: "~$630" },
           { label: "Total", value: "~$5,000", isTotal: true }
         ]
       },
       {
         heading: "‚ùì Questions to ask",
         questions: [
           "Why is the rego plate hidden?",
           "Has the Takata recall been done?"
         ]
       },
       {
         heading: "‚öñÔ∏è Your rights",
         text: "Under NSW law, you are entitled to..."
       },
       {
         heading: "üîó Sources",
         sources: [
           { label: "ACCC ‚Äî Takata recall", url: "https://..." }
         ]
       }
     ]
   }
   ============================================================ */

// -- Utility: format today's date
function formatDate() {
  var d = new Date();
  var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  return d.getDate() + ' ' + months[d.getMonth()] + ' ' + d.getFullYear();
}

// -- Loading animation
function animateLoading(callback) {
  var steps = ['step1','step2','step3','step4'];
  var delay = 800;
  var i = 0;
  function next() {
    if (i > 0) {
      document.getElementById(steps[i-1]).classList.remove('active');
      document.getElementById(steps[i-1]).classList.add('done');
    }
    if (i < steps.length) {
      document.getElementById(steps[i]).classList.add('active');
      i++;
      setTimeout(next, delay + Math.random() * 400);
    } else {
      setTimeout(callback, 300);
    }
  }
  next();
}

// -- Render the report from JSON data
function renderReport(data) {
  // Hide loading, show report
  document.getElementById('reportLoading').style.display = 'none';
  document.getElementById('reportCard').style.display = 'block';
  document.getElementById('deliveryCard').style.display = 'block';
  document.getElementById('dataWarning').style.display = 'block';
  document.getElementById('anotherReport').style.display = 'block';

  // Top bar meta
  document.getElementById('reportDate').textContent = formatDate();
  document.getElementById('reportCategory').textContent = data.category || '';

  // Header
  document.getElementById('reportTitle').textContent = data.title || '';
  var metaParts = [];
  if (data.price) metaParts.push(data.price);
  if (data.location) metaParts.push(data.location);
  document.getElementById('reportMeta').textContent = metaParts.join(' ¬∑ ');
  document.getElementById('reportCatBadge').textContent = (data.category || '').toUpperCase();

  // Verdict
  var v = data.verdict;
  var verdictHtml = '<div class="report-verdict report-verdict--' + v.level + '">';
  verdictHtml += '<div class="report-verdict-icon">' + v.icon + '</div>';
  verdictHtml += '<div><strong>' + v.heading + '</strong>';
  verdictHtml += '<p>' + v.summary + '</p></div></div>';
  document.getElementById('reportVerdict').innerHTML = verdictHtml;

  // Sections
  var sectionsHtml = '';
  data.sections.forEach(function(section) {
    sectionsHtml += '<div class="report-section">';
    sectionsHtml += '<h4>' + section.heading + '</h4>';

    // Flags
    if (section.flags) {
      section.flags.forEach(function(flag) {
        sectionsHtml += '<div class="report-flag report-flag--' + flag.level + '">';
        sectionsHtml += '<strong>' + flag.title + '</strong>';
        sectionsHtml += '<p>' + flag.detail + '</p></div>';
      });
    }

    // Costs
    if (section.costs) {
      sectionsHtml += '<div class="report-costs">';
      section.costs.forEach(function(cost) {
        var cls = cost.isTotal ? ' report-cost-total' : '';
        sectionsHtml += '<div class="report-cost-row' + cls + '">';
        sectionsHtml += '<span>' + cost.label + '</span>';
        sectionsHtml += '<span>' + cost.value + '</span></div>';
      });
      sectionsHtml += '</div>';
    }

    // Questions
    if (section.questions) {
      sectionsHtml += '<div class="report-questions">';
      section.questions.forEach(function(q, idx) {
        sectionsHtml += '<div class="report-question">' + (idx + 1) + '. ' + q + '</div>';
      });
      sectionsHtml += '</div>';
    }

    // Text block (rights, etc)
    if (section.text) {
      sectionsHtml += '<p class="report-text">' + section.text + '</p>';
    }

    // Sources
    if (section.sources) {
      sectionsHtml += '<div class="report-sources">';
      section.sources.forEach(function(src) {
        sectionsHtml += '<a href="' + src.url + '" target="_blank" rel="noopener">' + src.label + '</a>';
      });
      sectionsHtml += '</div>';
    }

    sectionsHtml += '</div>';
  });
  document.getElementById('reportSections').innerHTML = sectionsHtml;
}

// -- Show error state
function showError(msg) {
  document.getElementById('reportLoading').style.display = 'none';
  document.getElementById('reportError').style.display = 'block';
  if (msg) document.getElementById('reportErrorMsg').textContent = msg;
}

// -- Email toggle
document.getElementById('emailBtn').addEventListener('click', function() {
  var form = document.getElementById('emailForm');
  form.style.display = form.style.display === 'none' ? 'block' : 'none';
  if (form.style.display === 'block') {
    document.getElementById('emailInput').focus();
  }
});

// -- Email send (placeholder ‚Äî calls Netlify Function later)
document.getElementById('emailSend').addEventListener('click', function() {
  var email = document.getElementById('emailInput').value.trim();
  if (!email || !email.includes('@')) {
    document.getElementById('emailInput').style.borderColor = '#DC2626';
    return;
  }
  // TODO: Call send-report Netlify Function
  var btn = document.getElementById('emailSend');
  btn.textContent = 'sending...';
  btn.disabled = true;
  setTimeout(function() {
    btn.textContent = '‚úì sent!';
    btn.style.background = '#065F46';
  }, 1500);
});

// -- PDF download (placeholder ‚Äî generates PDF later)
document.getElementById('downloadPdf').addEventListener('click', function() {
  // TODO: Call generate-pdf Netlify Function or client-side PDF
  var btn = document.getElementById('downloadPdf');
  btn.innerHTML = '<span>‚è≥</span> generating PDF...';
  setTimeout(function() {
    btn.innerHTML = '<span>‚úì</span> PDF ready!';
    btn.style.background = '#065F46';
  }, 2000);
});

/* ============================================================
   DEMO DATA ‚Äî for testing only. Remove or gate behind ?demo=
   ============================================================ */
var demoData = {
  vehicle: {
    category: 'vehicle',
    title: '2015 Jeep Wrangler Unlimited Sport Auto 4x4 MY15',
    price: '$22,500',
    location: 'NSW ¬∑ Private seller ¬∑ 156,000 km',
    country: 'Australia',
    verdict: {
      level: 'red',
      icon: 'üö®',
      heading: 'VERDICT: CAUTION ‚Äî SIGNIFICANT RISKS IDENTIFIED',
      summary: 'This listing has multiple red flags including an active safety recall, hidden registration details preventing history verification, and registration expiring imminently. Do not purchase without completing all recommended checks.'
    },
    sections: [
      {
        heading: 'üö® Critical findings',
        flags: [
          { level: 'red', title: 'Takata airbag recall ‚Äî confirmed for this model', detail: 'The 2015 Jeep Wrangler JK (MY2014‚Äì2016) is part of the compulsory Takata airbag recall affecting 6,733 vehicles in Australia. The passenger-side beta airbag inflator can degrade over time. In a crash, the metal inflator housing may rupture and propel fragments toward occupants. This defect can cause serious injury or death. The recall repair is free through any authorised Jeep dealer ‚Äî call 1300 133 079.' },
          { level: 'red', title: 'Registration plate hidden', detail: '"Check with seller" ‚Äî without the registration plate, we cannot verify PPSR status, finance or encumbrance, write-off history, or stolen vehicle status. This is a significant red flag in any private vehicle sale.' }
        ]
      },
      {
        heading: '‚ö†Ô∏è Additional concerns',
        flags: [
          { level: 'amber', title: 'Registration expiring February 2026', detail: 'Expires this month. Budget for re-registration costs. An expired registration may also indicate the vehicle has been sitting unregistered ‚Äî ask when it was last driven.' },
          { level: 'amber', title: 'High fuel consumption: 11.7 L/100km', detail: '3.6L V6 Pentastar engine ‚Äî expect approximately $3,500+ per year in fuel at current prices. Factor this into your total cost of ownership.' }
        ]
      },
      {
        heading: 'üí∞ Hidden costs (NSW estimate)',
        costs: [
          { label: 'Stamp duty', value: '~$630' },
          { label: 'Transfer fee', value: '$33' },
          { label: 'CTP insurance', value: '~$650/year' },
          { label: 'Registration renewal', value: '~$370/year' },
          { label: 'Fuel (estimated annual)', value: '~$3,500/year' },
          { label: 'Estimated first-year costs beyond purchase', value: '~$5,183', isTotal: true }
        ]
      },
      {
        heading: '‚ùì Questions to ask the seller',
        questions: [
          'Why is the registration plate hidden from the listing?',
          'Has the Takata airbag recall been completed? Do you have documentation?',
          'Can you provide or allow me to purchase a PPSR report?',
          'When was the vehicle last serviced, and by whom?',
          'Why is the registration expiring so soon ‚Äî has it been sitting unregistered?',
          'Are there any known mechanical issues not mentioned in the listing?'
        ]
      },
      {
        heading: '‚öñÔ∏è Your rights (NSW)',
        text: 'Under NSW law, private vehicle sales are covered by the <em>Australian Consumer Law</em>. The vehicle must match its description and be of acceptable quality. You are entitled to a cooling-off period if purchased through a dealer. For private sales, always obtain a PPSR certificate ($2) and verify the VIN matches the registration documents. We strongly recommend an independent pre-purchase inspection before proceeding.'
      },
      {
        heading: 'üîó Sources used in this report',
        sources: [
          { label: 'ACCC Product Safety ‚Äî Jeep Wrangler JK Takata airbag recall (6,733 vehicles)', url: 'https://www.productsafety.gov.au/recalls/fca-australia-pty-ltd-jeep-wrangler-jk-my2014-2016' },
          { label: 'Is My Airbag Safe? ‚Äî Check your vehicle by registration plate', url: 'https://www.ismyairbagsafe.com.au' },
          { label: 'PPSR ‚Äî Personal Property Securities Register ($2 check)', url: 'https://www.ppsr.gov.au' },
          { label: 'Service NSW ‚Äî Check vehicle registration status', url: 'https://www.service.nsw.gov.au/transaction/check-vehicle-registration' },
          { label: 'Revenue NSW ‚Äî Motor vehicle stamp duty calculator', url: 'https://www.revenue.nsw.gov.au/taxes-duties-levies-royalties/motor-vehicle-duty' }
        ]
      }
    ]
  },
  property: {
    category: 'property',
    title: '108/125 Arthur Street, Parramatta NSW 2150',
    price: '$655,000',
    location: 'Parramatta ¬∑ 2 bed ¬∑ 1 bath ¬∑ 1 car ¬∑ Apartment',
    country: 'Australia',
    verdict: {
      level: 'red',
      icon: 'üö®',
      heading: 'VERDICT: HIGH RISK ‚Äî DO NOT PROCEED WITHOUT INDEPENDENT LEGAL ADVICE',
      summary: 'This listing contains multiple critical red flags. NSW Fair Trading issued a Building Work Rectification Order in June 2023 for serious load-bearing defects at this address ‚Äî yet the listing claims "proven structural integrity." The developer is not named. The photographs are of a different apartment. Do not proceed without independent building inspection and legal advice.'
    },
    sections: [
      {
        heading: 'üö® Critical findings',
        flags: [
          { level: 'red', title: 'NSW Fair Trading issued a Building Work Rectification Order (June 2023)', detail: 'The order relates to serious structural load-bearing defects in the building under the Residential Apartment Buildings Act 2020. The listing\'s claim of "proven structural integrity and independent quality oversight" directly contradicts this government enforcement action. Builder: Citibuild Design & Construction Pty Ltd (ABN 78 610 243 564).' },
          { level: 'red', title: 'Photographs shown are not of this apartment', detail: 'The listing\'s own fine print states: "Online images shown are from Apartment 208 ($675,000) ‚Äî an identical apartment located one floor higher. Some images have been digitally styled." You are being shown a different, more expensive apartment that has been virtually staged.' },
          { level: 'red', title: 'Developer identity deliberately omitted', detail: 'The listing refers to "a reputable team" without naming anyone. Other listings in the same building name Citibuild Design & Construction Pty Ltd and Madad Property Group. The deliberate omission, combined with the rectification order, raises serious transparency concerns.' }
        ]
      },
      {
        heading: '‚ö†Ô∏è Additional concerns',
        flags: [
          { level: 'amber', title: 'Strata management not yet active', detail: 'Managed by Ace Body Corporate, Prospect ‚Äî but "management commences post-strata registration." No strata history, no AGM minutes, no maintenance records to review.' },
          { level: 'amber', title: 'Strata levy: $822.62 per quarter ($3,290/year)', detail: 'For a 2-bedroom apartment in a 64-unit building, this is on the higher end. With potential structural issues, there is risk of special levies.' }
        ]
      },
      {
        heading: 'üí∞ Hidden costs (NSW estimate)',
        costs: [
          { label: 'Stamp duty', value: '~$24,457' },
          { label: 'Strata levies', value: '~$3,290/year' },
          { label: 'Council rates (Parramatta)', value: '~$1,200‚Äì$1,600/year' },
          { label: 'Water rates', value: '~$700‚Äì$1,000/year' },
          { label: 'Contents insurance', value: '~$300‚Äì$500/year' },
          { label: 'Estimated first-year total beyond purchase', value: '~$30,000‚Äì$31,000', isTotal: true }
        ]
      },
      {
        heading: '‚ùì Questions to ask before purchasing',
        questions: [
          'Why is the developer (Citibuild Design & Construction) not named on this listing?',
          'What is the current status of the NSW Fair Trading Building Work Rectification Order issued June 2023?',
          'Can I inspect the actual Unit 108, not Apartment 208 or a display unit?',
          'Can I see the independent quality oversight report referenced in the listing?',
          'Has the rectification of load-bearing defects been completed and signed off?',
          'What was S & A Property Holdings\' role, and why are they no longer involved?'
        ]
      },
      {
        heading: '‚öñÔ∏è Your rights (NSW)',
        text: 'Under NSW law, you are entitled to a 5-business-day cooling-off period after exchanging contracts. You may also be entitled to protections under the <em>Home Building Act 1989</em> for defects in buildings under 6 years old (structural) and 2 years (non-structural). We strongly recommend engaging an independent building inspector and solicitor before proceeding.'
      },
      {
        heading: 'üîó Sources used in this report',
        sources: [
          { label: 'NSW Fair Trading ‚Äî RAB Act Orders Register (Building Work Rectification Order, June 2023)', url: 'https://www.fairtrading.nsw.gov.au/help-centre/online-tools/rab-act-orders-register' },
          { label: 'Allhomes ‚Äî Unit 101/125-129 Arthur St (names Citibuild as developer)', url: 'https://www.allhomes.com.au/unit-101-125-129-arthur-street-parramatta-nsw-2150' },
          { label: 'buy.nsw.gov.au ‚Äî Citibuild Design & Construction Pty Ltd (ABN 78 610 243 564)', url: 'https://buy.nsw.gov.au/supplier/profile/169777' },
          { label: 'Planning Alerts ‚Äî DA history for 125 Arthur St', url: 'https://www.planningalerts.org.au/applications/1126410' }
        ]
      }
    ]
  }
};

/* ============================================================
   PAGE INITIALISATION
   ============================================================ */
(function() {
  var params = new URLSearchParams(window.location.search);
  var demo = params.get('demo');

  // DEMO MODE ‚Äî for testing
  if (demo && demoData[demo]) {
    animateLoading(function() {
      renderReport(demoData[demo]);
    });
    return;
  }

  // PRODUCTION MODE ‚Äî read from sessionStorage
  var reportJson = sessionStorage.getItem('listinglens_report');
  if (reportJson) {
    try {
      var data = JSON.parse(reportJson);
      animateLoading(function() {
        renderReport(data);
      });
      // Clear sessionStorage after reading ‚Äî one-time use
      sessionStorage.removeItem('listinglens_report');
    } catch (e) {
      showError('We received your report but couldn\'t display it. Please contact us.');
    }
    return;
  }

  // NO DATA ‚Äî check if there's a session token to generate
  var session = params.get('session');
  if (session) {
    // TODO: In production, this calls verify-session and generate-report
    // For now, show the loading state
    showError('Report generation is not yet connected. This page will work once the backend is built.');
    return;
  }

  // NOTHING ‚Äî redirect home
  window.location.href = '/';
})();
</script>
</body>
</html>